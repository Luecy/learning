<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width">
		<style>
			@charset "UTF-8";body,html{height:100%}#p_fixed,#p_space{padding-left:100%}#p_fixed,#p_space,#p_state{top:0;left:0;margin:0}#button_cancel,#p_state{z-index:2;position:fixed}#canvas,#img,textarea{width:100%}*{display:block;box-sizing:border-box;position:relative;font:100% sans-serif}.div_UI,head,script{display:none}#button_download,#input_canvasSize,#input_jpg,#radio_jpg,#radio_png,.input_radio,a{display:inline}body{margin:0;padding:8px}textarea{border:1px solid gray;padding:2px;resize:none;border-radius:2px;white-space:pre}textarea:focus{outline:0;border:2px solid orange}button{border:1px solid gray;border-radius:2px;padding:2px 7px;background-color:#f0f0f0}button:active{border-color:#909090;background-color:#f8f8f8}#canvas{padding-bottom:1rem}#div_UI,#div_download{border:1px solid #000;padding:1rem}#input_jpg{visibility:hidden}#p_space{padding-top:5rem}#p_fixed{z-index:1;position:fixed;padding-top:4rem;background-color:#fdd}#p_state{padding:1rem}#button_cancel{top:4rem;right:8px}#UI_resize{display:block}
		</style>
		<title>Image Editor</title>
	</head>
	<body>
		<p id="p_space"></p>
		<p id="p_fixed"></p>
		<p id="p_state">ページを読み込んでいます</p>
		<button type="button" id="button_cancel">キャンセル</button>
		<input type="file" id="input_file">
		<button type="button" id="button_reset">reset</button>
		<div id="div_download">
			<input type="text" id="input_filename" value="00.png" placeholder="file name">
			<input type="radio" name="image_type" id="radio_png" checked>png<br>
			<input type="radio" name="image_type" id="radio_jpg">jpg
			<input type="number" id="input_jpg" value="0.85" placeholder="JPEGの圧縮率"><br>
			<button id="button_download" type="button">ダウンロード</button>
			<a id="anchor">download</a>
		</div>
		<div>
			<input type="radio" name="radio" id="radio_resize" class="input_radio" checked>resize<br>
			<input type="radio" name="radio" id="radio_enlarge" class="input_radio">enlarge<br>
			<input type="radio" name="radio" id="radio_reverse" class="input_radio">reverse<br>
			<input type="radio" name="radio" id="radio_space" class="input_radio">space<br>
			<input type="radio" name="radio" id="radio_cut" class="input_radio">cut<br>
			<input type="radio" name="radio" id="radio_insert" class="input_radio">insert<br>
			<input type="radio" name="radio" id="radio_rotate" class="input_radio">rotate<br>
			<input type="radio" name="radio" id="radio_decreaseColor" class="input_radio">decrease color<br>
		</div>
		<div id="div_UI">
			<div id="UI_resize" class="div_UI">
				<input type="number" id="input_resize_width" placeholder="width">
				<input type="number" id="input_resize_height" placeholder="height">
				<input type="number" id="input_resize_ratio" placeholder="倍率">
				<button id="button_resize" type="button">resize</button>
			</div>
			<div id="UI_enlarge" class="div_UI">
				<input type="number" id="input_enlarge" placeholder="自然数">
				<button id="button_enlarge" type="button">enlarge</button>
			</div>
			<div id="UI_reverse" class="div_UI">
				<button id="button_reverse" type="button">左右反転</button>
			</div>
			<div id="UI_space" class="div_UI">
				<input type="number" id="input_space_left" placeholder="left">
				<input type="number" id="input_space_right" placeholder="right">
				<input type="number" id="input_space_top" placeholder="top">
				<input type="number" id="input_space_bottom" placeholder="bottom">
				<input type="text" id="input_space_background" value="#000000ff" placeholder="background-color">
				<button id="button_space" type="button">実行</button>
			</div>
			<div id="UI_cut" class="div_UI">
				<input type="number" id="input_cut_left" placeholder="left">
				<input type="number" id="input_cut_right" placeholder="right">
				<input type="number" id="input_cut_top" placeholder="top">
				<input type="number" id="input_cut_bottom" placeholder="bottom">
				<button id="button_cut" type="button">cut</button>
			</div>
			<div id="UI_insert" class="div_UI">
				<input type="file" id="input_file_insert">
				<input type="number" id="input_insert_left" placeholder="left">
				<input type="number" id="input_insert_top" placeholder="top">
				<button id="button_insert" type="button">insert</button>
			</div>
			<div id="UI_rotate" class="div_UI">
				<button id="button_rotate" type="button">rotate</button>
			</div>
			<div id="UI_decreaseColor" class="div_UI">
				<button type="button" id="button_decrease4bit">rgb4bit</button>
				<button type="button" id="button_decrease2bit">rgb2bit</button>
				<button type="button" id="button_grayscale">grayscale</button>
				<button type="button" id="button_monochrome">monochrome</button>
				<button type="button" id="button_alpha1bit">alpha1bit</button>
			</div>
		</div>
		Canvas.style.width<input type="text" id="input_canvasSize" value="100%" placeholder="default: 100%">
		<button type="button" id="button_undo">undo/redo</button>
		<div id="div_canvasSize"></div>
		<canvas id="canvas" width=256 height=256></canvas>
		<button type="button" id="button_canvasToImg">img要素に描画</button>
		<button type="button" id="button_imgToCanvas">img要素から描画</button>
		<img id="img">
		<div>
			<script src="./lib/editImage_v1.1.0.min.js"></script>
			<script src="./lib/library_v1.0.0.min.js"></script>
			<script src="./script/constant.js"></script>
			<script src="./script/eventListener.js"></script>
			<script src="./script/main.js"></script>
		</div>
		<script>
			(()=>{"use strict";let t="editImage.js",a=Object.prototype.toString,e=async(t,e=document.querySelector("canvas"),i,l,n=0,r=0,d=!0)=>{if("[object File]"!==a.call(t)&&"[object Blob]"!==a.call(t))return null;let c=new FileReader,o=new Image;return c.readAsDataURL(t),o.src=await new Promise(t=>{c.onload=()=>{t(c.result)}}),await o.decode().then(()=>{let t=e.getContext("2d");void 0==i&&(i=o.naturalWidth),void 0==l&&(l=o.naturalHeight),void 0==n&&(n=0),void 0==r&&(r=0),d&&(e.width=i,e.height=l),t.drawImage(o,n,r,i,l)}).catch(t=>t)},i=async(t,e)=>{let i=(()=>"[object HTMLCanvasElement]"===a.call(e)?e:document.createElement("canvas"))``,l=i.getContext("2d");return"[object ImageData]"===a.call(t)?(i.width=t.width,i.height=t.height,l.putImageData(t,0,0),i):"[object HTMLImageElement]"===a.call(t)||"[object ImageBitmap]"===a.call(t)||"[object HTMLCanvasElement]"===a.call(t)?("[object HTMLImageElement]"===a.call(t)?(i.width=t.naturalWidth,i.height=t.naturalHeight):(i.width=t.width,i.height=t.height),l.drawImage(t,0,0),i):"[object File]"===a.call(t)||"[object Blob]"===a.call(t)?new Promise(a=>{let e=new FileReader;e.readAsDataURL(t),e.onload=()=>{let t=new Image;t.src=e.result,t.onload=()=>{i.width=t.naturalWidth,i.height=t.naturalHeight,l.drawImage(t,0,0),a(i)}}}):void 0},l=async t=>{if("[object ImageData]"===a.call(t))return t;if("[object HTMLCanvasElement]"===a.call(t)){let e=t.getContext("2d");return e.getImageData(0,0,t.width,t.height)}{let l=await i(t),n=l.getContext("2d");return n.getImageData(0,0,l.width,l.height)}},n=async(t,e="image/png",l=.85,n=!1)=>{if(("[object Blob]"===a.call(t)||"[object File]"===a.call(t))&&!1==n)return t;let r=await i(t);return new Promise(t=>{r.toBlob(a=>{t(a)},e,l)})},r=async t=>{if("[object HTMLImageElement]"===a.call(t))return t;{let e=await n(t),i=await new Promise(t=>{let a=new FileReader;a.readAsDataURL(e),a.onload=()=>{t(a.result)}}),l=new Image;return l.src=i,l.decode().then(()=>l).catch(t=>t)}},d=async t=>"[object ImageBitmap]"===a.call(t)?t:"[object HTMLImageElement]"===a.call(t)?createImageBitmap(t,0,0,t.naturalWidth,t.naturalHeight):createImageBitmap(t),c=async(t,a)=>{if("canvas"===a)return await i(t);if("imageElement"===a)return await r(t);if("imageData"===a)return await l(t);if("imageBitmap"===a)return await d(t);if("blob"===a)return await n(t)},o=(()=>{let t=(t=0)=>new Promise(a=>{setTimeout(a,t)});return async(a,e,i)=>{await t();let l=Math.trunc(i/100),n=i%100,r=0;for(let d=0;d<100;d++){for(let c=0;c<l;c++)a();r<n&&(a(),r++),e(),await t()}}})``,h=async(t,a,i,l="imageData")=>{if(!Number.isInteger(a)||a<1||!Number.isInteger(i)||i<1)return null;let r=await n(t),d=document.createElement("canvas");return await e(r,d,a,i),await c(d,l)},g=async(t,a,e,i="imageData",n)=>{let r=await l(t);if(!Number.isInteger(a)||a<2)return null;void 0==e&&(e=document.createElement("canvas")),void 0==n&&(n=()=>{}),e.width=r.width*a,e.height=r.height*a;{let d=e.getContext("2d"),h=r.data.length/4,g=0,w=0,$=0,u=1;return await o(()=>{let t=r.data[$++],i=r.data[$++],l=r.data[$++],n=r.data[$++];d.fillStyle=`rgba(${t}, ${i}, ${l}, ${n})`,d.fillRect(g,w,a,a),g<e.width-a?g+=a:(g=0,w+=a)},()=>{n(u),u++},h),await c(e,i)}},w=async(t,a="imageData")=>{let e=document.createElement("canvas"),i=e.getContext("2d"),l=await r(t),n=l.naturalWidth,d=l.naturalHeight;return e.width=d,e.height=n,i.rotate(90*Math.PI/180),i.translate(0,-d),i.drawImage(l,0,0,n,d),await c(e,a)},$=async(t,a="imageData")=>{let e=await l(t),i=e.width,n=e.height,r=new ImageData(i,n),d=0,o=4*i-4;for(let h=0;h<n;h++){for(let g=0;g<i;g++){for(let w=0;w<4;w++)r.data[o]=e.data[d],d++,o++;o-=8}o+=8*i}return await c(r,a)},u=(()=>{let t=t=>((!Number.isInteger(t=Number(t))||t<0)&&(t=0),t);return async(a,e,i,n,r,d="#000000ff",o="imageData")=>{e=t(e),i=t(i),n=t(n),r=t(r);{let h=await l(a),g=document.createElement("canvas"),w=g.getContext("2d");return g.width=h.width+e+i,g.height=h.height+n+r,w.fillStyle=d,w.fillRect(0,0,g.width,g.height),w.putImageData(h,e,n),await c(g,o)}}})``,s=async(t,a,e,i,n,r="imageData")=>{let d=document.createElement("canvas"),o=d.getContext("2d"),h=await l(t);return d.width=h.width-(a+e),d.height=h.height-(i+n),o.putImageData(h,-a,-i),await c(d,r)},m=async(t,a,e,n,d,o="imageData")=>{let h=(()=>void 0==d?document.createElement("canvas"):d)``,g=h.getContext("2d");return t=await l(t),a=await r(a),await i(t,h),g.drawImage(a,e,n),c(h,o)},f=(()=>{let t=t=>17*(t=Math.round(t/17)),a=t=>85*(t=Math.round(t/85)),e=(t,a,e)=>{let i=[t,a,e];return i.sort((t,a)=>a-t),Math.round((i[0]+i[2])/2)};return async(i,n=null,r=null,d="imageData",h)=>{h||(h=()=>{});let g=await l(i),w=new ImageData(g.width,g.height),$=g.data.length/4,u=0,s=1;return await o(()=>{if("4bit"==n)for(let i=0;i<3;i++)w.data[u]=t(g.data[u]),u++;else if("2bit"==n)for(let l=0;l<3;l++)w.data[u]=a(g.data[u]),u++;else if("grayscale"==n){let d=e(g.data[u],g.data[u+1],g.data[u+2]);w.data[u]=d,w.data[u+1]=d,w.data[u+2]=d,u+=3}else if("monochrome"==n){let c=e(g.data[u],g.data[u+1],g.data[u+2]);c=c>=128?255:0,w.data[u]=c,w.data[u+1]=c,w.data[u+2]=c,u+=3}else for(let o=0;o<3;o++)w.data[u]=g.data[u],u++;"4bit"==r?w.data[u]=t(g.data[u]):"1bit"==r?g.data[u]>0?w.data[u]=255:w.data[u]=0:!1===r?w.data[u]=255:w.data[u]=g.data[u],u++},()=>{h(s),s++},$),c(w,d)}})``;if(!0===self.hasOwnProperty(t))throw Error(`window["${t}"] is in conflict`);for(let b in self[t]=Object.preventExtensions({drawImagefileToCanvas:e,imageToCanvas:i,toImageData:l,imageToBlob:n,toImageElement:r,toImageBitmap:d,changeType:c,asyncLoop:o,resize:h,enlarge:g,rotate:w,reverse:$,space:u,cut:s,insert:m,decreaseColor:f}),self[t])Object.defineProperty(self[t],b,{writable:!1});Object.defineProperty(self,t,{writable:!1})})``;
			(()=>{"use strict";let e=new Map([["self",["defineProperty","freezeProperty","$","sleep","downloadFile","download","canvasToURL","drawImagefileToCanvas"]],["Math",["randomInt"]],["Blob.prototype",["uint8Array","dataURL"]],["String.prototype",["atob","btoa","toUTF8","toUTF16","base16Decode","normalizeNewline","trimIndent"]],["Uint8Array.prototype",["btoa","text","loop","random","base16Encode"]]]),t=(e,t,r="self",n=!1,l=!0,o=!0)=>{let a=e=>{let t=e.split("."),r=self;for(let n of t)r=r[n];return r},i=(e="self",t=[""])=>{"string"==typeof t&&(t=[t]);let r=a(e);for(let n of t)try{if(!0===r.hasOwnProperty(n))throw Error(`[${e}.${n}] is in conflict`)}catch(l){console.error(l)}};!1===Array.isArray(e)&&(e=[e]),!1===Array.isArray(t)&&(t=[t]),i(r,e),r=a(r);for(let f=0;f<t.length;f++)Object.defineProperty(r,e[f],{value:t[f],configurable:l,writable:n,enumerable:o})},r=[t,(e,t=self)=>{"string"==typeof e&&(e=[e]);for(let r=0;r<e.length;r++)Object.defineProperty(t,e[r],{configurable:!1,enumerable:!0,writable:!1})},e=>{let t=document.querySelectorAll(e);return 1===t.length?t[0]:t},(e=0)=>new Promise(t=>{setTimeout(t,e)}),(e,t="00",r=document.querySelector("a"))=>{"[object Uint8Array]"===toString.call(e)&&(e=new Blob([e]));{let n=URL.createObjectURL(e);return""==t&&(t="00.txt"),r.download=t,r.href=n,n}},(e,t="00")=>{let r=document.createElement("a");"[object Uint8Array]"===toString.call(e)&&(e=new Blob([e]));{let n=URL.createObjectURL(e);r.href=n,r.download=t,r.click(),URL.revokeObjectURL(n)}},(e=document.querySelector("canvas"),t="image/png",r=.85)=>new Promise(n=>{e.toBlob(e=>{let t=URL.createObjectURL(e);n(t)},t,r)}),async(e,t=document.querySelector("canvas"),r,n,l=0,o=0,a=!0)=>{if("[object File]"!==toString.call(e)&&"[object Blob]"!==toString.call(e))return null;let i=new FileReader,f=new Image;return i.readAsDataURL(e),f.src=await new Promise(e=>{i.onload=()=>{e(i.result)}}),await f.decode().then(()=>{let e=t.getContext("2d");void 0==r&&(r=f.naturalWidth),void 0==n&&(n=f.naturalHeight),void 0==l&&(l=0),void 0==o&&(o=0),a&&(t.width=r,t.height=n),e.drawImage(f,l,o,r,n)}).catch(e=>e)},(e=255,t=0)=>Math.floor(Math.random()*(e-t+1)+t),async function(){let e=await this.arrayBuffer();return new Uint8Array(e)},function(){return new Promise(e=>{let t=new FileReader;t.readAsDataURL(this),t.onload=()=>{e(t.result)}})},function(){let e=atob(this.replace(/.*,/,"")),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},async function(){let e=new Blob([this]),t=await e.arrayBuffer(),r=new Uint8Array(t),n="";for(let l of r)n+=String.fromCharCode(l);return btoa(n)},function(){return new TextEncoder().encode(this)},function(e,t=!1){let r=(()=>{let e=Array(this.length);for(let t=0;t<this.length;t++){let r=this.charCodeAt(t);e[t]=r.toString(16).padStart(4,"0")}return e.join("").split("")})``,n=new Uint8Array(2*this.length);for(let l=0,o=0;l<r.length;l++){let a=r[o]+r[o+1];o+=2,n[l]=parseInt(a,16)}if(e=(()=>"be"===e||"BE"===e?"BE":"le"===e||"LE"===e?"LE":void 0)``,t=(()=>{let r=[254,255];return void 0===e||"BE"===e&&!0==t?r:"LE"===e&&!0==t&&[255,254]})``,"LE"===e)for(let i=0;i<n.length;i+=2){let f=n[i],c=n[i+1];n[i]=c,n[i+1]=f}if(!1!==t){let h=new Uint8Array(n.length+2),$=0;for(let u of(h[$++]=t[0],h[$++]=t[1],n))h[$++]=u;return h}return n},function(){let e=this.replace(/[^0-9A-Fa-f]/g,"").split(""),t=new Uint8Array(e.length/2);for(let r=0,n=0;r<t.length;r++){let l=e[n]+e[n+1];t[r]=parseInt(l,16),n+=2}return t},function(e="\n"){return this.replace(/\r\n|\r|\n/g,e)},function(e=!0,t=!0){let r=this.replace(/^ +|^\t+/mg,"");return!0==e&&(r=r.trimStart()),!0==t&&(r=r.trimEnd()),r},function(){let e="";for(let t of this)e+=String.fromCharCode(t);return btoa(e)},function(e="UTF-8"){return"UTF-16"===e&&(e="UTF-16BE"),new Promise(t=>{let r=new Blob([this]),n=new FileReader;n.readAsText(r,e),n.onload=()=>{t(n.result)}})},function(e=0,t=255,r=0,n=this.length-1){let l=e;for(let o=r;o<=n;o++)this[o]=l,++l>t&&(l=e);return this},function(e=0,t=255,r=0,n=this.length-1){for(let l=r;l<=n;l++)this[l]=Math.floor(Math.random()*(t-e+1)+e);return this},function(e="",t=!0,r=!0){let n=Array(this.length);for(let l=0;l<n.length;l++)n[l]=this[l].toString(16),!0===r&&(n[l]=n[l].toUpperCase()),!0===t&&(n[l]=n[l].padStart(2,"0"));return n.join(e)}],n=0;for(let l of e){let o=l[0],a=l[1],i=(()=>{let e=Array(a.length);for(let t=0;t<e.length;t++)e[t]=r[n],n++;return e})``;t(a,i,o)}})``;
			(()=>{"use strict";let{imageToCanvas:e,toImageData:n}=self["editImage.js"],t={loading:!0,cancel:!1},a=$("#p_state"),i=$("#input_filename"),s=$("#radio_png"),d=$("#radio_jpg"),l=$("#input_jpg"),r=$("#anchor"),c=$("#div_canvasSize"),g=$("#canvas"),o=g.getContext("2d"),u=()=>{c.innerText="width: "+g.width+"\nheight: "+g.height},h=(()=>{let t=[null,null],i=async()=>{a.innerText="undo中",await sleep();let n=t[1];t[1]=t[0],t[0]=n,await e(n,g),a.innerText="undoしました"};return i.save=async e=>{t[1]=t[0],t[0]=await n(e)},i})``;defineProperty("constant.js",Object.freeze({state:t,p_state:a,input_filename:i,radio_png:s,radio_jpg:d,input_jpg:l,anchor:r,div_canvasSize:c,canvas:g,context:o,showCanvasSize:u,undo:h}))})``;
			(()=>{"use strict";let t=Object.prototype.toString,{state:i,p_state:a,input_filename:n,radio_png:e,radio_jpg:l,input_jpg:c,canvas:o,context:r,showCanvasSize:u,undo:d}=self["constant.js"],{imageToCanvas:s,imageToBlob:g,toImageElement:w,resize:f,enlarge:v,rotate:y,reverse:h,space:T,cut:p,insert:x,decreaseColor:b}=self["editImage.js"];delete self["editImage.js"];let _=t=>{if(/\D/.test(t))throw Error("0以上の整数を入力してください");return Number(t)};$("#button_cancel").onclick=()=>{i.cancel=!0};{let k=$("#input_file"),m=$("#button_reset"),j,z;k.onchange=async()=>{if(!0!=i.loading&&void 0!=k.files[0]){if(i.loading=!0,a.innerText="画像を読み込んでいます",await sleep(),await drawImagefileToCanvas(j=k.files[0],o)!==void 0){i.loading=!1,a.innerText="画像を選択してください";return}z=j,u(),await d.save(o),i.loading=!1,a.innerText="画像を読み込みました"}},m.onclick=async()=>{if(!0!=i.loading){if(i.loading=!0,a.innerText="リセット中",await sleep(),void 0==z){a.innerText="画像ファイルが読み込まれていません",i.loading=!1;return}await drawImagefileToCanvas(z,o),u(),await d.save(o),i.loading=!1,a.innerText="リセットしました"}}}{let I=t=>{let i=n.value;i=i.replace(/\.\w*$/,""),n.value=i+t};e.oninput=()=>{c.style.visibility="hidden",I(".png")},l.oninput=()=>{c.style.visibility="visible",I(".jpg")}}$("#button_download").onclick=async()=>{if(!0==i.loading)return;i.loading=!0,a.innerText="ダウンロード準備中",await sleep(),URL.revokeObjectURL(anchor.href);let t=n.value,r=(()=>e.checked?"image/png":l.checked?"image/jpeg":void 0)``,u=(()=>{let t=Number(c.value);return t<0||t>1?(c.value=.85,c.value=.85,.85):(c.value=t,t)})``;anchor.download=t;try{anchor.href=await canvasToURL(o,r,u),a.innerText="ダウンロード可能"}catch(d){a.innerText=d}finally{i.loading=!1}};{let D=$(".input_radio"),L=$(".div_UI"),U=()=>{for(let t of L)t.style.display="none"};for(let R=0;R<D.length;R++)D[R].oninput=()=>{U(),L[R].style.display="inline"}}{let S=$("#input_resize_width"),A=$("#input_resize_height"),C=$("#input_resize_ratio");$("#button_resize").onclick=async()=>{if(!0!=i.loading){i.loading=!0,i.cancel=!1,a.innerText="リサイズ中",await sleep();try{let t,n,e;if(""==C.value)n=Number(S.value),e=Number(A.value);else{let l=Number(C.value);n=Math.round(o.width*l),e=Math.round(o.height*l)}if(n<=0||e<=0)throw Error("自然数を入力してください");if(n>16384||e>16384)throw Error("最大サイズを超えています");if(t=await f(o,n,e),i.cancel)throw"処理を中断しました";await s(t,o),u(),await d.save(o),a.innerText="リサイズしました"}catch(c){a.innerText=c}finally{i.loading=!1}}}}{let E=$("#input_enlarge"),H=t=>{if(a.innerText=`拡大中：${t}%`,i.cancel)throw"処理を中断しました"};$("#button_enlarge").onclick=async()=>{if(!0!=i.loading){i.loading=!0,i.cancel=!1,a.innerText="拡大中",await sleep();try{let t=Number(E.value);if(/\D/.test(t)||t<2)throw Error("2以上の自然数を入力してください");let n=await v(o,t,void 0,void 0,H);await s(n,o),u(),await d.save(o),a.innerText="拡大しました"}catch(e){a.innerText=e}finally{i.loading=!1}}}}$("#button_reverse").onclick=async()=>{if(!0!=i.loading){i.loading=!0,i.cancel=!1,a.innerText="左右反転中",await sleep();try{let t=await h(o);if(i.cancel)throw"処理を中断しました";await s(t,o),await d.save(o),a.innerText="左右反転完了"}catch(n){a.innerText=n}finally{i.loading=!1}}};{let M=$("#input_space_left"),O=$("#input_space_right"),q=$("#input_space_top"),B=$("#input_space_bottom"),F=$("#input_space_background");$("#button_space").onclick=async()=>{if(!0!=i.loading){i.loading=!0,i.cancel=!1,a.innerText="空白追加中",await sleep();try{let t=_(M.value),n=_(O.value),e=_(q.value),l=_(B.value),c=F.value,r=await T(o,t,n,e,l,c);if(i.cancel)throw"処理を中断しました";await s(r,o),u(),await d.save(o),a.innerText="空白追加完了"}catch(g){a.innerText=g}finally{i.loading=!1}}}}{let G=$("#input_cut_left"),J=$("#input_cut_right"),K=$("#input_cut_top"),N=$("#input_cut_bottom");$("#button_cut").onclick=async()=>{if(!0!=i.loading){i.loading=!0,i.cancel=!1,a.innerText="切り取り中",await sleep();try{let t=_(G.value),n=_(J.value),e=_(K.value),l=_(N.value),c=await p(o,t,n,e,l);if(i.cancel)throw"処理を中断しました";await s(c,o),u(),await d.save(o),a.innerText="切り取り完了"}catch(r){a.innerText=r}finally{i.loading=!1}}}}{let P=$("#input_file_insert"),Q=$("#input_insert_left"),V=$("#input_insert_top");$("#button_insert").onclick=async()=>{if(!0!=i.loading&&void 0!=P.files[0]){i.loading=!0,i.cancel=!1,a.innerText="画像を差し込み中",await sleep();try{let n=_(Q.value),e=_(V.value),l=await w(P.files[0]);if(i.cancel)throw"処理を中断しました";if("[object HTMLImageElement]"!==t.call(l))throw Error("画像の差し込みに失敗しました");await x(o,l,n,e,o),await d.save(o),a.innerText="画像を差し込みました"}catch(c){a.innerText=c}finally{i.loading=!1}}}}$("#button_rotate").onclick=async()=>{if(!0!=i.loading){i.loading=!0,i.cancel=!1,a.innerText="画像を回転中",await sleep();try{let t=await y(o);if(i.cancel)throw"処理を中断しました";await s(t,o),u(),await d.save(o),a.innerText="回転しました"}catch(n){a.innerText=n}finally{i.loading=!1}}};{let W=t=>{if(a.innerText=`減色中：${t}%`,i.cancel)throw"処理を中断しました"},X=async(t,n)=>{if(!0!=i.loading){i.loading=!0,i.cancel=!1,a.innerText="減色中",await sleep();try{let e=await b(o,t,n,"imageData",W);await s(e,o),u(),await d.save(o),a.innerText="減色しました"}catch(l){a.innerText=l}finally{i.loading=!1}}};$("#button_decrease4bit").onclick=()=>{X("4bit","4bit")},$("#button_decrease2bit").onclick=()=>{X("2bit","1bit")},$("#button_grayscale").onclick=()=>{X("grayscale")},$("#button_monochrome").onclick=()=>{X("monochrome")},$("#button_alpha1bit").onclick=()=>{X(void 0,"1bit")}}{let Y=$("#input_canvasSize");Y.oninput=()=>{o.style.width=Y.value}}{let Z=$("#button_undo");Z.onclick=async()=>{!0!=i.loading&&(i.loading=!0,await d(),u(),i.loading=!1)}}{let tt=$("#button_canvasToImg"),ti=$("#button_imgToCanvas"),ta=$("#img");tt.onclick=async()=>{if(!0!=i.loading){i.loading=!0,i.cancel=!1,a.innerText="img要素に描画中",await sleep();try{let t=await g(o),n=await (()=>new Promise(i=>{let a=new FileReader;a.readAsDataURL(t),a.onload=()=>{i(a.result)}}))``;if(i.cancel)throw"処理を中断しました";ta.src=n,a.innerText="img要素に描画しました"}catch(e){a.innerText=e}finally{i.loading=!1}}},ti.onclick=async()=>{if(!0!=i.loading){if(""===ta.src){a.innerText="img要素がありません";return}i.loading=!0,i.cancel=!1,a.innerText="img要素からcanvasに描画中",await sleep();try{let t=ta.src,n=t.atob(),e=new Blob([n]);if(await sleep(),i.cancel)throw"処理を中断しました";await s(e,o),u(),await d.save(o),a.innerText="img要素からcanvasに描画しました"}catch(l){a.innerText=l}finally{i.loading=!1}}}}})``;
			(async()=>{"use strict";let{state:t,p_state:a,canvas:e,context:i,showCanvasSize:$,undo:l}=self["constant.js"];i.fillStyle="#000000",i.fillRect(0,0,e.width,e.height),$(),await l.save(e),await l.save(e),a.innerText="画像を選択してください",t.loading=!1})``;
		</script>
	</body>
</html>
